<Lems
      xmlns="http://www.neuroml.org/lems/0.7.4"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.neuroml.org/lems/0.7.4 ../../LEMS/Schemas/LEMS/LEMS_v0.7.4.xsd"
      description="Rate based/population models translated using LEMS.">

    <ComponentType name="Theta2D"
                   description="2D model describing the Ott-Antonsen reduction of infinitely all-to-all coupled QIF neurons (Theta-neurons)."
                   value="">

        <!-- If empty then none -->
        <Constant name="I" symbol="" dimension="lo=-10.0, hi=10.0, step=0.01" value="0.0" description="???"/>
        <Constant name="Delta" symbol="" dimension="lo=0.0, hi=10.0, step=0.01" value="1.0" description="Vertical shift of the configurable nullcline."/>
        <Constant name="alpha" symbol="" dimension="lo=0.0, hi=1.0, step=0.1" value="1.0" description=":math:`\alpha` ratio of effect between long-range and local connectivity."/>
        <Constant name="s" symbol="" dimension="lo=-15.0, hi=15.0, step=0.01" value="0.0" description="QIF membrane reversal potential."/>
        <Constant name="k" symbol="" dimension="lo=-15.0, hi=15.0, step=0.01" value="0.0" description="Switch for the terms specific to Coombes model."/>
        <Constant name="J" symbol="" dimension="lo=-25.0, hi=25.0, step=0.0001" value="15.0" description="Constant parameter to scale the rate of feedback from the slow variable to the firing rate variable."/>
        <Constant name="eta" symbol="" dimension="lo=-10.0, hi=10.0, step=0.0001" value="-5.0" description="Constant parameter to scale the rate of feedback from the firing rate variable to itself"/>
        <Constant name="Gamma" symbol="" dimension="lo=0., hi=10.0, step=0.1" value="0.0" description="Derived from eterogeneous currents and synaptic weights (see Montbrio p.12)."/>
        <Constant name="gamma" symbol="" dimension="lo=-2.0, hi=2.0, step=0.1" value="1.0" description="Constant parameter to reproduce FHN dynamics where excitatory input currents are negative. It scales both I and the long range coupling term."/>

        <Dynamics>
            <!-- For each state variable a set of bondaries can be added to encompass the boundaries of the dynamic range -->
            <!-- Leave empty "" for no boundaries. Set None for one-sided boundaries, ie: "1.0, None" -->
            <StateVariable name="r" dimension="0., 2.0" boundaries="0.0, inf"/>
            <StateVariable name="V" dimension="-2.0, 1.5" boundaries=""/>

            <!-- Derived variables can be used to 'easify' the time dervivatives, enter the local coupling formulas or any formula -->
            <!-- sytax: [name]=[value] -->
            <!-- Define for ex. global and local coupling: c_0 = coupling[0, ] and lc_0 = local_coupling -->
            <!-- default numpy signature: _numpy_dfun(self, state_variables, coupling, local_coupling=0.0, ev=numexpr.evaluate) -->
            <DerivedVariable name="Coupling_global" exposure="" value="alpha * coupling[0]"/>
            <DerivedVariable name="Coupling_local" exposure="" value="(1-alpha) * local_coupling * r"/>
            <DerivedVariable name="Coupling_Term" exposure="" value="Coupling_global + Coupling_local"/>

            <!-- For conditionals use &lt(=); or &gt;(=) for less- or greater then (equal to)  -->
            <!-- Conditional now used for if statement using ternary operator: syntax: [on_true:exposure] if [expression:name] else [on_false:dimension] -->
            <TimeDerivative variable="dx" exposure="" value="Delta / 3.14 + 2 * V * r - k * r**2 + Gamma * r / 3.14"/>
            <TimeDerivative variable="dy" exposure="" value="V**2 - 3.14**2 * r**2 + eta + (k * s + J) * r - k * V * r + gamma * I + Coupling_Term"/>

        </Dynamics>

        <!-- Exposures are used for observables, for the name enter variable to be observed (usually states)
        and for dimension enter the reduction functionality-->
        <Exposure name="r" dimension="'r'', 'V'"/>

    </ComponentType>
</Lems>